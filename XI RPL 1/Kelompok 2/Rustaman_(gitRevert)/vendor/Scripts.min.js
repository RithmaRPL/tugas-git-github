gsap.registerPlugin(ScrollTrigger, MotionPathPlugin);
document.querySelectorAll('section').forEach(sec=>{
  if(!sec.querySelector('.credits')){
    let c=document.createElement('div');
    c.className='credits fade';
    c.innerHTML='<span>Rustaman Delvianova</span><span>Kelompok 2</span><span>XI RPL 1</span>';
    sec.appendChild(c);
  }
});
const heroTitle=document.querySelector('.hero h1');
const rotating=['git revert','Rekam Jejak','Rollback Aman','Kolaboratif'];
let idx=0;
function splitText(el){
  if(!el) return;
  const raw=el.textContent.trim();
  el.innerHTML=raw.split(/\s+/).map(w=>'<span class="split-word">'+[...w].map(c=>'<span class="split-char">'+c+'</span>').join('')+'</span>').join(' ');
}  
function animateChars(scope){
  const chars=scope.querySelectorAll('.split-char');
  gsap.fromTo(chars,{opacity:0,translateY:'1.1em',scale:.9,rotateX:65},{opacity:1,translateY:'0em',scale:1,rotateX:0,duration:.85,stagger:{each:.025,from:'start'},ease:'power3.out'});
} 
splitText(heroTitle);animateChars(document.querySelector('.hero'));
setInterval(()=>{
  idx=(idx+1)%rotating.length;
  gsap.to(heroTitle,{opacity:0,y:-20,duration:.4,ease:'power2.in',onComplete:()=>{heroTitle.textContent=rotating[idx];splitText(heroTitle);animateChars(document.querySelector('.hero'));}});
},4200);
// Taglines
document.querySelectorAll('.tagline').forEach(t=>{splitText(t);ScrollTrigger.create({trigger:t,start:'top 80%',onEnter:()=>animateChars(t),onEnterBack:()=>animateChars(t)});});
// Generic fades (bidirectional)
const fades=[...document.querySelectorAll('.fade')];
fades.forEach(el=>{
  gsap.set(el,{opacity:0,y:60});
  ScrollTrigger.create({
    trigger:el,
    start:'top 80%',
    end:'bottom top',
    onEnter:()=>gsap.to(el,{opacity:1,y:0,duration:.8,ease:'power3.out'}),
    onEnterBack:()=>gsap.to(el,{opacity:1,y:0,duration:.6,ease:'power3.out'}),
    onLeave:()=>gsap.to(el,{opacity:0,y:-40,duration:.5,ease:'power2.in'}),
    onLeaveBack:()=>gsap.to(el,{opacity:0,y:40,duration:.5,ease:'power2.in'})
  });
});
// Section cross-fade (hero persistent)
const sections=[...document.querySelectorAll('section')];
gsap.set(sections,{opacity:0});
let active=-1;
function activate(i){
  if(i===active) return;
  active=i;
  sections.forEach((s,j)=>{
    if(j===0){ 
      gsap.set(s,{opacity:1});
      return;
    }
    gsap.to(s,{opacity:j===i?1:0,duration:.9,ease:'power3.out'});
  });
}
sections.forEach((sec,i)=>{
  ScrollTrigger.create({
    trigger:sec,
    start:'top 60%',
    end:'bottom 40%',
    onEnter:()=>activate(i),
    onEnterBack:()=>activate(i)
  });
});
activate(0);
// Orbit motion
const path=document.getElementById('p1');
const dot=document.getElementById('dot');
if(path&&dot&&gsap.plugins.MotionPathPlugin){
  gsap.to(dot,{motionPath:{path:'#p1',align:'#p1',autoRotate:false},repeat:-1,duration:12,ease:'none'});
}

